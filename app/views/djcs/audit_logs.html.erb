<h1>Auditoría de DJC: <%= @djc.product_description %></h1>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Fecha</th>
      <th>Usuario</th>
      <th>Evento</th>
      <th>Cambios</th>
    </tr>
  </thead>
  <tbody>
    <% @logs.each do |log| %>
      <tr>
        <td><%= log.created_at.strftime("%d/%m/%Y %H:%M") %></td>
        <td>
          <%= User.find_by(id: log.whodunnit)&.email || 'Usuario desconocido' %>
        </td>
        <td><%= log.event.capitalize %></td>
        <td>
          <% if log.object_changes.present? %>
            <% safe_load_yaml(log.object_changes).each do |field, values| %>
              <strong><%= field.to_s.humanize %>:</strong><br>
              <% if field == "djc_file" && values.is_a?(Hash) %>
                Estado: <%= values[:status] %><br>
                Nombre: <%= values[:filename] %><br>
                Tipo: <%= values[:content_type] %><br>
                Tamaño: <%= number_to_human_size(values[:byte_size]) %><br>
              <% elsif field == "crs_files" && values.is_a?(Array) %>
                <% values.each do |file| %>
                  <strong>Archivo:</strong><br>
                  Nombre: <%= file[:filename] %><br>
                  Tipo: <%= file[:content_type] %><br>
                  Tamaño: <%= number_to_human_size(file[:byte_size]) %><br>
                  <hr>
                <% end %>
              <% else %>
                <% if values.is_a?(Array) %>
                  <%= values[0] || 'N/A' %> → <%= values[1] || 'N/A' %>
                <% else %>
                  <%= values %>
                <% end %>
              <% end %>
              <br>
            <% end %>
          <% else %>
            Sin cambios registrados
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>